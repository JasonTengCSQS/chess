<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>相弈 - 在线象棋平台</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#8B4513',
                        secondary: '#D2B48C',
                        accent: '#C69C6D',
                        board: '#E6CD8F',
                        dark: '#4A3728',
                        light: '#FFF8E1',
                        highlight: '#FFEB3B',
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .chess-shadow {
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            }
            .chess-piece {
                transition: transform 0.3s ease, box-shadow 0.3s ease;
            }
            .chess-piece:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.15);
            }
            .board-grid {
                background-image: linear-gradient(#000 1px, transparent 1px),
                                  linear-gradient(90deg, #000 1px, transparent 1px);
            }
            .bg-texture {
                background-image: url("https://picsum.photos/id/106/1000/1000");
                background-size: cover;
                background-position: center;
                background-attachment: fixed;
            }
            .scrollbar-hide::-webkit-scrollbar {
                display: none;
            }
            .scrollbar-hide {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            .btn-hover {
                transition: all 0.3s ease;
            }
            .btn-hover:hover {
                transform: translateY(-2px);
            }
        }
    </style>
</head>
<body class="font-inter bg-gray-100 min-h-screen flex flex-col overflow-x-hidden">
    <!-- 登录页面 -->
    <div id="login-page" class="fixed inset-0 z-50 flex items-center justify-center bg-texture">
        <div class="bg-white/90 backdrop-blur-md rounded-xl shadow-2xl p-8 w-full max-w-md mx-4 transform transition-all duration-500 hover:shadow-xl">
            <div class="text-center mb-6">
                <h1 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold text-primary mb-2">相弈</h1>
                <p class="text-gray-600">在线象棋平台</p>
            </div>
            
            <form id="login-form" class="space-y-4">
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="fa fa-user text-gray-400"></i>
                    </div>
                    <input type="text" id="username" class="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-300" placeholder="请输入用户名" required>
                </div>
                
                <div class="pt-2">
                    <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 px-4 rounded-lg transition-all duration-300 transform hover:scale-[1.02] focus:outline-none focus:ring-2 focus:ring-primary/50 focus:ring-offset-2">
                        登录并匹配对手
                    </button>
                </div>
            </form>
            
            <div class="mt-6 text-center">
                <p class="text-gray-600">已有账号? <a href="#" class="text-primary hover:underline">立即登录</a></p>
                <p class="text-gray-600 text-sm mt-2">没有账号? <a href="#" class="text-primary hover:underline">免费注册</a></p>
            </div>
        </div>
    </div>

    <!-- 主应用容器 -->
    <div id="app-container" class="hidden flex-1 flex flex-col">
        <!-- 顶部导航栏 -->
        <header class="bg-primary text-white shadow-md z-10">
            <div class="container mx-auto px-4 py-3 flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <i class="fa fa-chess-board text-2xl"></i>
                    <h1 class="text-xl font-bold">相弈</h1>
                </div>
                
                <div class="flex items-center space-x-6">
                    <div class="hidden md:flex items-center space-x-4">
                        <a href="#" class="hover:text-secondary transition-colors duration-200">首页</a>
                        <a href="#" class="hover:text-secondary transition-colors duration-200">排行榜</a>
                        <a href="#" class="hover:text-secondary transition-colors duration-200">教学</a>
                        <a href="#" class="hover:text-secondary transition-colors duration-200">社区</a>
                    </div>
                    
                    <div class="flex items-center space-x-2">
                        <div id="user-avatar" class="w-8 h-8 rounded-full bg-secondary flex items-center justify-center overflow-hidden">
                            <i class="fa fa-user text-primary"></i>
                        </div>
                        <span id="user-display-name" class="hidden md:inline">游客</span>
                        <button id="logout-btn" class="hover:text-secondary transition-colors duration-200">
                            <i class="fa fa-sign-out"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- 主内容区 -->
        <main class="flex-1 flex flex-col md:flex-row">
            <!-- 左侧边栏 -->
            <aside class="bg-white shadow-lg w-full md:w-64 p-4 space-y-6 transition-all duration-300">
                <div class="space-y-4">
                    <h2 class="text-lg font-semibold text-gray-800 flex items-center">
                        <i class="fa fa-user-circle mr-2 text-primary"></i>
                        个人资料
                    </h2>
                    
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="flex items-center space-x-3 mb-3">
                            <div id="profile-avatar" class="w-12 h-12 rounded-full bg-secondary flex items-center justify-center overflow-hidden">
                                <i class="fa fa-user text-primary text-xl"></i>
                            </div>
                            <div>
                                <h3 id="profile-name" class="font-medium text-gray-800">游客</h3>
                                <p class="text-xs text-gray-500">等级: 初学者</p>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-3 gap-2 text-center text-xs">
                            <div>
                                <p class="font-semibold text-primary">32</p>
                                <p class="text-gray-500">对局</p>
                            </div>
                            <div>
                                <p class="font-semibold text-green-600">18</p>
                                <p class="text-gray-500">胜场</p>
                            </div>
                            <div>
                                <p class="font-semibold text-red-600">14</p>
                                <p class="text-gray-500">败场</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <h2 class="text-lg font-semibold text-gray-800 flex items-center">
                        <i class="fa fa-trophy mr-2 text-primary"></i>
                        战绩统计
                    </h2>
                    
                    <div class="bg-gray-50 rounded-lg p-4">
                        <canvas id="stats-chart" height="150"></canvas>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <h2 class="text-lg font-semibold text-gray-800 flex items-center">
                        <i class="fa fa-users mr-2 text-primary"></i>
                        在线玩家
                    </h2>
                    
                    <div id="online-players" class="bg-gray-50 rounded-lg p-2 max-h-60 overflow-y-auto scrollbar-hide space-y-1">
                        <!-- 在线玩家列表会动态生成 -->
                        <div class="text-gray-500 text-sm italic text-center py-2">
                            正在加载玩家列表...
                        </div>
                    </div>
                </div>
            </aside>

            <!-- 中间内容区 -->
            <div class="flex-1 flex flex-col p-4 md:p-6">
                <!-- 匹配页面 -->
                <div id="matching-page" class="flex-1 flex flex-col items-center justify-center">
                    <div class="text-center mb-8">
                        <h2 class="text-2xl md:text-3xl font-bold text-primary mb-2">寻找对手中...</h2>
                        <p class="text-gray-600">正在为您匹配水平相当的对手</p>
                    </div>
                    
                    <div class="relative mb-8">
                        <div class="w-32 h-32 md:w-40 md:h-40 border-4 border-primary/20 border-t-primary rounded-full animate-spin"></div>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <i class="fa fa-chess-king text-4xl md:text-5xl text-primary"></i>
                        </div>
                    </div>
                    
                    <div class="text-center space-y-2">
                        <p class="text-gray-600">已等待 <span id="matching-time">0</span> 秒</p>
                        <p class="text-gray-500 text-sm">匹配成功后将自动开始游戏</p>
                    </div>
                    
                    <button id="cancel-match-btn" class="mt-8 px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg transition-all duration-300 transform hover:scale-[1.02] focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2">
                        取消匹配
                    </button>
                </div>

                <!-- 游戏页面 -->
                <div id="game-page" class="hidden flex-1 flex flex-col">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold text-primary">当前对局</h2>
                        <div class="flex space-x-2">
                            <button id="undo-btn" class="px-3 py-1.5 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded transition-all duration-200">
                                <i class="fa fa-undo mr-1"></i> 悔棋
                            </button>
                            <button id="resign-btn" class="px-3 py-1.5 bg-red-100 hover:bg-red-200 text-red-600 rounded transition-all duration-200">
                                <i class="fa fa-flag mr-1"></i> 认输
                            </button>
                        </div>
                    </div>
                    
                    <div class="flex flex-col lg:flex-row gap-4">
                        <!-- 象棋棋盘 -->
                        <div class="flex-1 bg-white rounded-xl shadow-lg p-4">
                            <div class="flex justify-between items-center mb-3">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 rounded-full bg-red-100 flex items-center justify-center">
                                        <span class="text-red-600 font-bold">红</span>
                                    </div>
                                    <div>
                                        <h3 id="red-player" class="font-medium text-gray-800">红方玩家</h3>
                                        <div class="flex items-center">
                                            <i class="fa fa-clock-o text-gray-400 mr-1"></i>
                                            <span id="red-time" class="text-sm text-gray-600">05:00</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="game-status" class="px-3 py-1 bg-gray-100 rounded-full text-sm font-medium text-gray-700">
                                    游戏进行中
                                </div>
                            </div>
                            
                            <div class="relative w-full max-w-md mx-auto aspect-square bg-board rounded-md overflow-hidden shadow-inner">
                                <div id="chessboard" class="absolute inset-0 board-grid bg-board" style="background-size: 11.11% 11.11%;">
                                    <!-- 棋盘线条和棋子将通过JS动态生成 -->
                                </div>
                            </div>
                            
                            <div class="flex justify-between items-center mt-3">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center">
                                        <span class="text-gray-800 font-bold">黑</span>
                                    </div>
                                    <div>
                                        <h3 id="black-player" class="font-medium text-gray-800">黑方玩家</h3>
                                        <div class="flex items-center">
                                            <i class="fa fa-clock-o text-gray-400 mr-1"></i>
                                            <span id="black-time" class="text-sm text-gray-600">05:00</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 聊天和走棋记录 -->
                        <div class="w-full lg:w-80 flex flex-col gap-4">
                            <!-- 走棋记录 -->
                            <div class="bg-white rounded-xl shadow-lg p-4 flex-1">
                                <h3 class="text-lg font-semibold text-gray-800 mb-2 flex items-center">
                                    <i class="fa fa-history mr-2 text-primary"></i>
                                    走棋记录
                                </h3>
                                
                                <div id="move-history" class="bg-gray-50 rounded-lg p-2 h-60 overflow-y-auto scrollbar-hide text-sm">
                                    <!-- 走棋记录将动态生成 -->
                                    <div class="text-gray-500 text-sm italic text-center py-4">
                                        对局开始后显示走棋记录
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 聊天区域 -->
                            <div class="bg-white rounded-xl shadow-lg p-4">
                                <h3 class="text-lg font-semibold text-gray-800 mb-2 flex items-center">
                                    <i class="fa fa-comments mr-2 text-primary"></i>
                                    聊天
                                </h3>
                                
                                <div id="chat-messages" class="bg-gray-50 rounded-lg p-2 h-40 mb-2 overflow-y-auto scrollbar-hide text-sm">
                                    <!-- 聊天消息将动态生成 -->
                                    <div class="text-gray-500 text-sm italic text-center py-4">
                                        开始聊天吧！
                                    </div>
                                </div>
                                
                                <div class="flex">
                                    <input type="text" id="chat-input" class="flex-1 px-3 py-2 border border-gray-300 rounded-l-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-300" placeholder="输入消息...">
                                    <button id="send-chat-btn" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-r-lg transition-all duration-300">
                                        <i class="fa fa-paper-plane"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 游戏结束页面 -->
                <div id="game-result-page" class="hidden flex-1 flex flex-col items-center justify-center">
                    <div class="bg-white rounded-2xl shadow-xl p-8 max-w-md w-full mx-4 text-center">
                        <div id="result-icon" class="w-20 h-20 mx-auto mb-4 rounded-full flex items-center justify-center bg-green-100">
                            <i class="fa fa-trophy text-4xl text-green-600"></i>
                        </div>
                        
                        <h2 id="result-title" class="text-2xl font-bold text-gray-800 mb-2">恭喜，你赢了！</h2>
                        <p id="result-message" class="text-gray-600 mb-6">你击败了对手，获得了30积分</p>
                        
                        <div class="bg-gray-50 rounded-lg p-4 mb-6">
                            <div class="flex justify-between items-center mb-3">
                                <span class="text-gray-600">对局时间</span>
                                <span id="result-time" class="font-medium">8分32秒</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">积分变化</span>
                                <span id="result-points" class="font-medium text-green-600">+30</span>
                            </div>
                        </div>
                        
                        <div class="flex space-x-4">
                            <button id="play-again-btn" class="flex-1 bg-primary hover:bg-primary/90 text-white font-medium py-3 px-4 rounded-lg transition-all duration-300 transform hover:scale-[1.02] focus:outline-none focus:ring-2 focus:ring-primary/50 focus:ring-offset-2">
                                再来一局
                            </button>
                            <button id="back-to-home-btn" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-3 px-4 rounded-lg transition-all duration-300 transform hover:scale-[1.02] focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2">
                                返回首页
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- 页脚 -->
        <footer class="bg-gray-800 text-white py-6">
            <div class="container mx-auto px-4">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="mb-4 md:mb-0">
                        <div class="flex items-center space-x-2">
                            <i class="fa fa-chess-board text-xl"></i>
                            <span class="font-bold text-lg">相弈</span>
                        </div>
                        <p class="text-gray-400 text-sm mt-1">在线象棋平台</p>
                    </div>
                    
                    <div class="flex space-x-6 mb-4 md:mb-0">
                        <a href="#" class="text-gray-400 hover:text-white transition-colors duration-200">
                            <i class="fa fa-facebook"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors duration-200">
                            <i class="fa fa-twitter"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors duration-200">
                            <i class="fa fa-instagram"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors duration-200">
                            <i class="fa fa-youtube-play"></i>
                        </a>
                    </div>
                    
                    <div class="text-gray-400 text-sm">
                        &copy; 2025 相弈. 保留所有权利.
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // 全局变量
        let username = '';
        let gameState = {
            currentPlayer: 'red',
            redTime: 300, // 5分钟
            blackTime: 300,
            redPlayer: '玩家1',
            blackPlayer: '玩家2',
            moves: [],
            gameOver: false
        };
        
        // DOM元素
        const loginPage = document.getElementById('login-page');
        const appContainer = document.getElementById('app-container');
        const loginForm = document.getElementById('login-form');
        const usernameInput = document.getElementById('username');
        const userDisplayName = document.getElementById('user-display-name');
        const profileName = document.getElementById('profile-name');
        const logoutBtn = document.getElementById('logout-btn');
        const matchingPage = document.getElementById('matching-page');
        const matchingTime = document.getElementById('matching-time');
        const cancelMatchBtn = document.getElementById('cancel-match-btn');
        const gamePage = document.getElementById('game-page');
        const gameResultPage = document.getElementById('game-result-page');
        const resultTitle = document.getElementById('result-title');
        const resultMessage = document.getElementById('result-message');
        const resultTime = document.getElementById('result-time');
        const resultPoints = document.getElementById('result-points');
        const resultIcon = document.getElementById('result-icon');
        const playAgainBtn = document.getElementById('play-again-btn');
        const backToHomeBtn = document.getElementById('back-to-home-btn');
        const redPlayer = document.getElementById('red-player');
        const blackPlayer = document.getElementById('black-player');
        const redTime = document.getElementById('red-time');
        const blackTime = document.getElementById('black-time');
        const gameStatus = document.getElementById('game-status');
        const chessboard = document.getElementById('chessboard');
        const moveHistory = document.getElementById('move-history');
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const sendChatBtn = document.getElementById('send-chat-btn');
        const undoBtn = document.getElementById('undo-btn');
        const resignBtn = document.getElementById('resign-btn');
        
        // 初始化统计图表
        function initStatsChart() {
            const ctx = document.getElementById('stats-chart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['胜场', '败场', '平局'],
                    datasets: [{
                        data: [18, 14, 0],
                        backgroundColor: [
                            '#4CAF50',
                            '#F44336',
                            '#FFC107'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                boxWidth: 12,
                                padding: 15
                            }
                        }
                    },
                    cutout: '70%'
                }
            });
        }
        
        // 生成在线玩家列表
        function generateOnlinePlayers() {
            const players = [
                { name: '象棋大师', rank: '大师', status: '在线' },
                { name: '业余高手', rank: '业余8段', status: '游戏中' },
                { name: '初学者', rank: '业余1段', status: '在线' },
                { name: '中盘专家', rank: '业余6段', status: '在线' },
                { name: '布局爱好者', rank: '业余4段', status: '在线' }
            ];
            
            const onlinePlayers = document.getElementById('online-players');
            onlinePlayers.innerHTML = '';
            
            players.forEach(player => {
                const playerElement = document.createElement('div');
                playerElement.className = `flex items-center justify-between p-2 rounded ${player.status === '在线' ? 'hover:bg-gray-100' : 'opacity-70'}`;
                
                const statusDot = document.createElement('div');
                statusDot.className = `w-2 h-2 rounded-full ${player.status === '在线' ? 'bg-green-500' : 'bg-gray-400'}`;
                
                const nameRank = document.createElement('div');
                nameRank.className = 'flex items-center space-x-2';
                
                const nameSpan = document.createElement('span');
                nameSpan.className = 'font-medium text-gray-800';
                nameSpan.textContent = player.name;
                
                const rankSpan = document.createElement('span');
                rankSpan.className = 'text-xs bg-gray-100 text-gray-600 px-2 py-0.5 rounded';
                rankSpan.textContent = player.rank;
                
                nameRank.appendChild(nameSpan);
                nameRank.appendChild(rankSpan);
                
                playerElement.appendChild(nameRank);
                playerElement.appendChild(statusDot);
                
                if (player.status === '在线') {
                    playerElement.addEventListener('click', () => challengePlayer(player.name));
                    playerElement.style.cursor = 'pointer';
                }
                
                onlinePlayers.appendChild(playerElement);
            });
        }
        
        // 挑战玩家
        function challengePlayer(playerName) {
            // 显示匹配中状态
            showMatchingPage();
            
            // 模拟匹配成功
            setTimeout(() => {
                gameState.redPlayer = username;
                gameState.blackPlayer = playerName;
                redPlayer.textContent = username;
                blackPlayer.textContent = playerName;
                showGamePage();
                startGame();
            }, 2000);
        }
        
        // 初始化棋盘
        function initChessboard() {
            chessboard.innerHTML = '';
            
            // 红方棋子
            const redPieces = [
                { type: 'r-king', x: 4, y: 9 },
                { type: 'r-advisor', x: 3, y: 9 },
                { type: 'r-advisor', x: 5, y: 9 },
                { type: 'r-elephant', x: 2, y: 9 },
                { type: 'r-elephant', x: 6, y: 9 },
                { type: 'r-horse', x: 1, y: 9 },
                { type: 'r-horse', x: 7, y: 9 },
                { type: 'r-chariot', x: 0, y: 9 },
                { type: 'r-chariot', x: 8, y: 9 },
                { type: 'r-cannon', x: 1, y: 7 },
                { type: 'r-cannon', x: 7, y: 7 },
                { type: 'r-pawn', x: 0, y: 6 },
                { type: 'r-pawn', x: 2, y: 6 },
                { type: 'r-pawn', x: 4, y: 6 },
                { type: 'r-pawn', x: 6, y: 6 },
                { type: 'r-pawn', x: 8, y: 6 }
            ];
            
            // 黑方棋子
            const blackPieces = [
                { type: 'b-king', x: 4, y: 0 },
                { type: 'b-advisor', x: 3, y: 0 },
                { type: 'b-advisor', x: 5, y: 0 },
                { type: 'b-elephant', x: 2, y: 0 },
                { type: 'b-elephant', x: 6, y: 0 },
                { type: 'b-horse', x: 1, y: 0 },
                { type: 'b-horse', x: 7, y: 0 },
                { type: 'b-chariot', x: 0, y: 0 },
                { type: 'b-chariot', x: 8, y: 0 },
                { type: 'b-cannon', x: 1, y: 2 },
                { type: 'b-cannon', x: 7, y: 2 },
                { type: 'b-pawn', x: 0, y: 3 },
                { type: 'b-pawn', x: 2, y: 3 },
                { type: 'b-pawn', x: 4, y: 3 },
                { type: 'b-pawn', x: 6, y: 3 },
                { type: 'b-pawn', x: 8, y: 3 }
            ];
            
            // 创建所有棋子
            [...redPieces, ...blackPieces].forEach(piece => {
                createChessPiece(piece.type, piece.x, piece.y);
            });
        }
        
        // 创建棋子
        function createChessPiece(type, x, y) {
            const piece = document.createElement('div');
            const isRed = type.startsWith('r-');
            const pieceType = type.split('-')[1];
            
            // 设置棋子样式和内容
            piece.className = `absolute w-[10%] h-[10%] rounded-full flex items-center justify-center font-bold text-lg chess-piece chess-shadow ${isRed ? 'bg-red-50 text-red-700 border-2 border-red-600' : 'bg-gray-100 text-gray-800 border-2 border-gray-700'}`;
            piece.style.left = `${x * 11.11}%`;
            piece.style.top = `${y * 11.11}%`;
            piece.style.transform = 'translate(-50%, -50%)';
            piece.style.zIndex = 10;
            
            // 设置棋子文字
            switch(pieceType) {
                case 'king':
                    piece.textContent = isRed ? '帅' : '将';
                    break;
                case 'advisor':
                    piece.textContent = isRed ? '仕' : '士';
                    break;
                case 'elephant':
                    piece.textContent = isRed ? '相' : '象';
                    break;
                case 'horse':
                    piece.textContent = '马';
                    break;
                case 'chariot':
                    piece.textContent = '车';
                    break;
                case 'cannon':
                    piece.textContent = '炮';
                    break;
                case 'pawn':
                    piece.textContent = isRed ? '兵' : '卒';
                    break;
            }
            
            // 添加点击事件
            piece.addEventListener('click', () => selectPiece(x, y, type));
            
            chessboard.appendChild(piece);
        }
        
        // 选择棋子
        function selectPiece(x, y, type) {
            // 简单示例：切换选中状态
            const pieces = chessboard.querySelectorAll('.chess-piece');
            pieces.forEach(p => p.classList.remove('ring-2', 'ring-yellow-500'));
            
            const selectedPiece = event.target.closest('.chess-piece');
            if (selectedPiece) {
                selectedPiece.classList.add('ring-2', 'ring-yellow-500');
                
                // 模拟走棋
                setTimeout(() => {
                    movePiece(x, y, type);
                }, 1000);
            }
        }
        
        // 移动棋子
        function movePiece(fromX, fromY, type) {
            // 简单示例：随机移动到相邻位置
            const directions = [
                { dx: -1, dy: 0 },
                { dx: 1, dy: 0 },
                { dx: 0, dy: -1 },
                { dx: 0, dy: 1 }
            ];
            
            // 随机选择一个方向
            const randomDir = directions[Math.floor(Math.random() * directions.length)];
            const toX = fromX + randomDir.dx;
            const toY = fromY + randomDir.dy;
            
            // 检查是否在棋盘范围内
            if (toX >= 0 && toX <= 8 && toY >= 0 && toY <= 9) {
                // 更新棋盘UI
                const pieces = chessboard.querySelectorAll('.chess-piece');
                pieces.forEach(p => p.classList.remove('ring-2', 'ring-yellow-500'));
                
                // 记录走棋
                const pieceName = type.split('-')[1];
                const moveText = `${gameState.currentPlayer === 'red' ? '红' : '黑'}${getPieceChineseName(pieceName)}(${fromX},${fromY}) → (${toX},${toY})`;
                recordMove(moveText);
                
                // 切换当前玩家
                gameState.currentPlayer = gameState.currentPlayer === 'red' ? 'black' : 'red';
                updateGameStatus();
            }
        }
        
        // 获取棋子中文名
        function getPieceChineseName(pieceType) {
            const names = {
                'king': '帅/将',
                'advisor': '仕/士',
                'elephant': '相/象',
                'horse': '马',
                'chariot': '车',
                'cannon': '炮',
                'pawn': '兵/卒'
            };
            return names[pieceType] || pieceType;
        }
        
        // 记录走棋
        function recordMove(moveText) {
            gameState.moves.push(moveText);
            
            const moveElement = document.createElement('div');
            moveElement.className = 'mb-1 p-1.5 rounded hover:bg-gray-100';
            moveElement.textContent = moveText;
            
            moveHistory.appendChild(moveElement);
            moveHistory.scrollTop = moveHistory.scrollHeight;
            
            // 模拟游戏结束
            if (gameState.moves.length >= 10 && !gameState.gameOver) {
                gameState.gameOver = true;
                setTimeout(endGame, 1000);
            }
        }
        
        // 更新游戏状态
        function updateGameStatus() {
            gameStatus.textContent = `${gameState.currentPlayer === 'red' ? '红' : '黑'}方回合`;
            gameStatus.className = `px-3 py-1 rounded-full text-sm font-medium ${gameState.currentPlayer === 'red' ? 'bg-red-100 text-red-700' : 'bg-gray-100 text-gray-700'}`;
        }
        
        // 开始游戏
        function startGame() {
            gameState = {
                currentPlayer: 'red',
                redTime: 300,
                blackTime: 300,
                redPlayer: gameState.redPlayer,
                blackPlayer: gameState.blackPlayer,
                moves: [],
                gameOver: false
            };
            
            initChessboard();
            updateGameStatus();
            startTimer();
            
            // 清空走棋记录和聊天
            moveHistory.innerHTML = '<div class="text-gray-500 text-sm italic text-center py-2">对局开始</div>';
            chatMessages.innerHTML = '<div class="text-gray-500 text-sm italic text-center py-4">开始聊天吧！</div>';
        }
        
        // 开始计时器
        function startTimer() {
            // 简单示例：每秒更新一次时间显示
            const timer = setInterval(() => {
                if (gameState.gameOver) {
                    clearInterval(timer);
                    return;
                }
                
                if (gameState.currentPlayer === 'red') {
                    gameState.redTime--;
                    redTime.textContent = formatTime(gameState.redTime);
                    
                    if (gameState.redTime <= 0) {
                        clearInterval(timer);
                        endGame('black');
                    }
                } else {
                    gameState.blackTime--;
                    blackTime.textContent = formatTime(gameState.blackTime);
                    
                    if (gameState.blackTime <= 0) {
                        clearInterval(timer);
                        endGame('red');
                    }
                }
            }, 1000);
        }
        
        // 格式化时间
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        // 结束游戏
        function endGame(winner = '') {
            gameState.gameOver = true;
            
            // 确定胜者
            if (!winner) {
                // 随机决定胜负（实际应用中应该根据游戏规则判断）
                winner = Math.random() > 0.5 ? 'red' : 'black';
            }
            
            const isUserWinner = (winner === 'red' && gameState.redPlayer === username) || 
                                 (winner === 'black' && gameState.blackPlayer === username);
            
            // 更新结果页面
            resultTitle.textContent = isUserWinner ? '恭喜，你赢了！' : '很遗憾，你输了';
            resultMessage.textContent = isUserWinner ? 
                `你击败了对手，获得了30积分` : 
                `你输给了对手，失去了10积分`;
            
            resultTime.textContent = formatTime(300 - Math.min(gameState.redTime, gameState.blackTime));
            resultPoints.textContent = isUserWinner ? '+30' : '-10';
            resultPoints.className = isUserWinner ? 'font-medium text-green-600' : 'font-medium text-red-600';
            
            resultIcon.className = isUserWinner ? 
                'w-20 h-20 mx-auto mb-4 rounded-full flex items-center justify-center bg-green-100' : 
                'w-20 h-20 mx-auto mb-4 rounded-full flex items-center justify-center bg-red-100';
            
            resultIcon.innerHTML = isUserWinner ? 
                '<i class="fa fa-trophy text-4xl text-green-600"></i>' : 
                '<i class="fa fa-meh-o text-4xl text-red-600"></i>';
            
            showGameResultPage();
        }
        
        // 显示登录页面
        function showLoginPage() {
            loginPage.classList.remove('hidden');
            appContainer.classList.add('hidden');
            matchingPage.classList.add('hidden');
            gamePage.classList.add('hidden');
            gameResultPage.classList.add('hidden');
        }
        
        // 显示应用主界面
        function showAppContainer() {
            loginPage.classList.add('hidden');
            appContainer.classList.remove('hidden');
        }
        
        // 显示匹配页面
        function showMatchingPage() {
            matchingTime.textContent = '0';
            showAppContainer();
            matchingPage.classList.remove('hidden');
            gamePage.classList.add('hidden');
            gameResultPage.classList.add('hidden');
            
            // 匹配计时器
            let seconds = 0;
            const matchTimer = setInterval(() => {
                seconds++;
                matchingTime.textContent = seconds;
                
                // 模拟匹配成功
                if (seconds >= 5) {
                    clearInterval(matchTimer);
                    gameState.redPlayer = username;
                    gameState.blackPlayer = "AI挑战者";
                    redPlayer.textContent = username;
                    blackPlayer.textContent = "AI挑战者";
                    showGamePage();
                    startGame();
                }
            }, 1000);
            
            // 取消匹配按钮事件
            cancelMatchBtn.onclick = () => {
                clearInterval(matchTimer);
                showAppContainer();
                matchingPage.classList.add('hidden');
                generateOnlinePlayers();
            };
        }
        
        // 显示游戏页面
        function showGamePage() {
            showAppContainer();
            matchingPage.classList.add('hidden');
            gamePage.classList.remove('hidden');
            gameResultPage.classList.add('hidden');
        }
        
        // 显示游戏结果页面
        function showGameResultPage() {
            showAppContainer();
            matchingPage.classList.add('hidden');
            gamePage.classList.add('hidden');
            gameResultPage.classList.remove('hidden');
        }
        
        // 登录事件
        loginForm.onsubmit = (e) => {
            e.preventDefault();
            username = usernameInput.value.trim();
            
            if (username) {
                userDisplayName.textContent = username;
                profileName.textContent = username;
                showMatchingPage();
                initStatsChart();
                generateOnlinePlayers();
            } else {
                alert('请输入用户名');
            }
        };
        
        // 登出事件
        logoutBtn.onclick = () => {
            username = '';
            usernameInput.value = '';
            showLoginPage();
        };
        
        // 聊天发送事件
        sendChatBtn.onclick = () => {
            sendChatMessage();
        };
        
        chatInput.onkeypress = (e) => {
            if (e.key === 'Enter') {
                sendChatMessage();
            }
        };
        
        // 发送聊天消息
        function sendChatMessage() {
            const message = chatInput.value.trim();
            if (message && username) {
                // 添加自己的消息
                const myMessage = document.createElement('div');
                myMessage.className = 'mb-2 text-right';
                
                const myMessageContent = document.createElement('div');
                myMessageContent.className = 'inline-block bg-primary text-white px-3 py-1.5 rounded-lg rounded-tr-none max-w-[80%]';
                myMessageContent.textContent = message;
                
                const myMessageInfo = document.createElement('div');
                myMessageInfo.className = 'text-xs text-gray-500 mt-0.5';
                myMessageInfo.textContent = username;
                
                myMessage.appendChild(myMessageContent);
                myMessage.appendChild(myMessageInfo);
                chatMessages.appendChild(myMessage);
                
                // 模拟对方回复
                setTimeout(() => {
                    const reply = [
                        '好棋！',
                        '这个布局很有意思',
                        '你棋力不错啊',
                        '我得好好想想',
                        '哈哈，这步有点意外'
                    ][Math.floor(Math.random() * 5)];
                    
                    const otherMessage = document.createElement('div');
                    otherMessage.className = 'mb-2';
                    
                    const otherMessageContent = document.createElement('div');
                    otherMessageContent.className = 'inline-block bg-gray-200 text-gray-800 px-3 py-1.5 rounded-lg rounded-tl-none max-w-[80%]';
                    otherMessageContent.textContent = reply;
                    
                    const otherMessageInfo = document.createElement('div');
                    otherMessageInfo.className = 'text-xs text-gray-500 mt-0.5';
                    otherMessageInfo.textContent = gameState.currentPlayer === username ? gameState.blackPlayer : gameState.redPlayer;
                    
                    otherMessage.appendChild(otherMessageInfo);
                    otherMessage.appendChild(otherMessageContent);
                    chatMessages.appendChild(otherMessage);
                    
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 1000);
                
                chatInput.value = '';
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        }
        
        // 再来一局按钮事件
        playAgainBtn.onclick = () => {
            showMatchingPage();
        };
        
        // 返回首页按钮事件
        backToHomeBtn.onclick = () => {
            showAppContainer();
            matchingPage.classList.add('hidden');
            gamePage.classList.add('hidden');
            gameResultPage.classList.add('hidden');
            generateOnlinePlayers();
        };
        
        // 悔棋按钮事件
        undoBtn.onclick = () => {
            if (gameState.moves.length > 0) {
                gameState.moves.pop();
                moveHistory.removeChild(moveHistory.lastChild);
                gameState.currentPlayer = gameState.currentPlayer === 'red' ? 'black' : 'red';
                updateGameStatus();
            }
        };
        
        // 认输按钮事件
        resignBtn.onclick = () => {
            const loser = gameState.currentPlayer;
            endGame(loser === 'red' ? 'black' : 'red');
        };
    </script>
</body>
</html>    
